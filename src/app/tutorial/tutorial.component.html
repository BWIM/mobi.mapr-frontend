<!-- Tutorial Overlay -->
<div 
  #overlay
  *ngIf="config.showOverlay"
  [class]="isFirstStep() ? 'fixed inset-0 bg-transparent backdrop-blur-sm z-10000 flex items-center justify-center tutorial-overlay' : 'fixed inset-0 z-10000 flex items-center justify-center tutorial-overlay'"
  [class.interactive-overlay]="isCurrentStepInteractive()"
  [class.non-interactive-overlay]="!isCurrentStepInteractive()"
  (click)="!isCurrentStepInteractive() && $event.stopPropagation()"
>
  <!-- Language Change Button -->
  <div class="absolute top-4 right-4 z-[1200]">
    <p-button
      icon="pi pi-globe"
      size="small"
      severity="secondary"
      [text]="true"
      [rounded]="true"
      [title]="'CREDITS.CHANGE_LANGUAGE' | translate"
      (onClick)="showLanguageDialog = true"
      class="bg-white shadow-lg hover:bg-gray-50"
    ></p-button>
  </div>

  <!-- Language Selection Dialog -->
  <p-dialog
    [(visible)]="showLanguageDialog"
    [modal]="true"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    class="z-[12000]"
    [style]="{width: '300px'}"
    [header]="'CREDITS.CHANGE_LANGUAGE' | translate"
    styleClass="tutorial-language-dialog"
  >
    <div class="space-y-3">
      <div
        *ngFor="let lang of languages"
        class="flex items-center justify-between p-3 rounded-lg border cursor-pointer hover:bg-gray-50 transition-colors"
        [class.border-blue-500]="currentLang === lang.code"
        [class.bg-blue-50]="currentLang === lang.code"
        (click)="switchLanguage(lang.code)"
      >
        <div class="flex items-center space-x-3">
          <i class="pi pi-check text-blue-600" *ngIf="currentLang === lang.code"></i>
          <i class="pi pi-circle text-gray-300" *ngIf="currentLang !== lang.code"></i>
          <span class="font-medium">{{ lang.name }}</span>
        </div>
      </div>
    </div>
  </p-dialog>

  <!-- Highlight Box for target elements -->
  <div 
    *ngIf="showHighlight && (currentStep?.type === 'highlight' || currentStep?.type === 'interactive') && currentStep?.showHighlight !== false"
    [ngStyle]="highlightStyle"
    class="tutorial-highlight"
  ></div>

  <!-- Info Box for highlight steps -->
  <div 
    *ngIf="currentStep?.type === 'highlight' || currentStep?.type === 'interactive'"
    [ngStyle]="getInfoBoxPosition()"
    class="bg-white rounded-lg shadow-lg p-4 max-w-sm border border-gray-200 tutorial-info-box z-[1200]"
  >
    <div class="flex items-start space-x-3">
      <div class="flex-shrink-0">
        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
          <i class="pi pi-info-circle text-blue-600 text-sm"></i>
        </div>
      </div>
      <div class="flex-1 min-w-0">
        <h3 class="text-sm font-medium text-gray-900 mb-1">
          {{ (currentStep?.title || '') | translate }}
        </h3>
        <p class="text-sm text-gray-600">
          {{ (currentStep?.content || '') | translate }}
        </p>
        <p *ngIf="currentStep?.languageHint" class="text-xs text-blue-600 mt-2">
          {{ currentStep?.languageHint || '' | translate }}
        </p>
        <p *ngIf="currentStep?.nextHint" class="text-xs text-blue-600 mt-2">
          {{ currentStep?.nextHint || '' | translate }}
        </p>

      </div>
    </div>
  </div>

  <!-- Centered Info Box for informative steps -->
  <div 
    *ngIf="currentStep?.type === 'informative'"
    class="absolute top-[16.67vh] left-1/2 transform -translate-x-1/2 bg-white rounded-lg shadow-lg p-6 max-w-md mx-4 border border-gray-200 tutorial-info-box z-[1200]"
  >
    <div class="text-center">
      <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <i class="pi pi-lightbulb text-blue-600 text-xl"></i>
      </div>
      <h3 class="text-lg font-medium text-gray-900 mb-3">
        {{ (currentStep?.title || '') | translate }}
      </h3>
      <p class="text-gray-600 mb-6">
        {{ (currentStep?.content || '') | translate }}
      </p>
      <p *ngIf="currentStep?.nextHint" class="text-xs text-blue-600 mt-2">
        {{ currentStep?.nextHint || '' | translate }}
      </p>
    </div>
  </div>

  <!-- Navigation Controls -->
  <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 z-[1200]">
    <div class="bg-white rounded-lg shadow-lg p-4 tutorial-navigation-container">
      <!-- Progress Indicator -->
      <div class="tutorial-progress-container">
        <span class="text-sm text-gray-600">
          {{ 'TUTORIAL.STEP' | translate }} {{ config.currentStepIndex + 1 }} {{ 'TUTORIAL.OF' | translate }} {{ currentSet?.steps?.length || 0 }}
        </span>
        <p-progressBar 
          [value]="(config.currentStepIndex + 1) / (currentSet?.steps?.length || 1) * 100"
          [showValue]="false"
          styleClass="w-24"
        ></p-progressBar>
      </div>

      <!-- Navigation Buttons -->
      <div class="tutorial-buttons-container">
        <!-- <p-button 
          *ngIf="!isFirstStep()"
          icon="pi pi-chevron-left"
          [label]="'TUTORIAL.PREVIOUS' | translate"
          size="small"
          severity="secondary"
          (onClick)="previousStep()"
        ></p-button> -->
        
        <p-button 
          *ngIf="!isLastStep()"
          icon="pi pi-chevron-right"
          iconPos="right"
          [label]="'TUTORIAL.NEXT' | translate"
          title="{{'TUTORIAL.NEXT' | translate}}"
          size="small"
          class="continue-button"
          [disabled]="isNextButtonDisabled()"
          (onClick)="nextStep()"
        ></p-button>
        
        <p-button 
          *ngIf="isLastStep()"
          icon="pi pi-check"
          [label]="'TUTORIAL.FINISH' | translate"
          title="{{'TUTORIAL.FINISH' | translate}}"
          size="small"
          class="continue-button"
          severity="info"
          (onClick)="completeTutorial()"
        ></p-button>
      </div>

      <!-- Skip Button -->
      <p-button 
        icon="pi pi-times"
        size="small"
        severity="secondary"
        class="skip-button"
        id="skip-button"
        *ngIf="isFirstStep()"
        title="{{'TUTORIAL.SKIP' | translate}}"
        text
        (onClick)="skipTutorial(); $event.stopPropagation()"
      ></p-button>
    </div>
  </div>
</div>
