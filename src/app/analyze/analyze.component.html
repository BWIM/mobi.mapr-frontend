<p-dialog 
    [(visible)]="visible"
    [modal]="true"
    [style]="{width: '80vw', height: '80vh'}"
    [draggable]="false"
    [resizable]="false"
    [dismissableMask]="true"
    [maximizable]="true"
    styleClass="analyze-dialog"
    (onHide)="triggerTutorial()"
    [header]="'ANALYZE.TITLE' | translate">
    
    <!-- Loading Spinner -->
    <div *ngIf="loading" class="flex justify-center items-center h-full">
        <div class="flex flex-col items-center">
            <p class="text-center text-sm text-gray-500 mb-4">{{ 'ANALYZE.LOADING.HINT' | translate }}</p>
            <p-progressSpinner></p-progressSpinner>
        </div>
    </div>
    
    <!-- Content -->
    <div *ngIf="!loading" class="flex flex-col h-full">
        <!-- Properties Header - Minimal Space -->
        <div *ngIf="properties" class="flex items-center justify-between p-3 bg-gray-50 border-b">
            <div class="flex items-center space-x-3">
                <h2 class="text-lg font-semibold">{{properties.name}}</h2>
                <span class="px-2 py-1 rounded-full text-white text-sm font-medium"
                      [style.backgroundColor]="getScore().color">
                    {{ getScoreName(getScore().score) }} ({{ getScore().score * 100 | number: '1.0-0' }}%)
                </span>
            </div>
            <div class="tooltip-container">
                <i class="pi pi-info-circle cursor-help"
                   pTooltip="{{'ANALYZE.PROPERTIES.POPULATION' | translate}}: {{properties.population}}"
                   tooltipPosition="top"></i>
            </div>
        </div>

        <!-- Tabs Container - Takes Remaining Space -->
        <p-tabs [value]="'activities'" class="flex-1" (activeIndexChange)="triggerChartResize()">
            <p-tablist>
                <p-tab value="activities">Aktivit√§ten</p-tab>
                <p-tab value="persona">Persona</p-tab>
            </p-tablist>
            
            <!-- Activities Tab -->
            <p-tabpanel [value]="'activities'" class="h-full">
                <div class="flex flex-col h-full">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-medium">{{ 'ANALYZE.ACTIVITIES.TITLE' | translate }}</h3>
                        <p-button 
                            [icon]="sortBy === 'score' ? 'pi pi-sort-amount-down' : 'pi pi-sort-amount-up'"
                            (onClick)="toggleSort()"
                            [pTooltip]="sortBy === 'score' ? 'Nach Gewichtung sortieren' : 'Nach Score sortieren'"
                            tooltipPosition="left"
                            styleClass="p-button-text p-button-sm">
                        </p-button>
                    </div>
                    <div *ngIf="hasActivityData()" class="flex-1 chart-wrapper">
                        <p-chart 
                            type="bar" 
                            [data]="activitiesChartData" 
                            [options]="barChartOptions">
                        </p-chart>
                    </div>
                    <div *ngIf="!hasActivityData()" class="flex-1 flex items-center justify-center">
                        <p class="text-gray-500">{{ 'ANALYZE.ACTIVITIES.NO_DATA' | translate }}</p>
                    </div>
                </div>
            </p-tabpanel>

            <!-- Persona Tab -->
            <p-tabpanel [value]="'persona'" class="h-full">
                <div class="flex flex-col h-full">
                    <h3 class="text-lg font-medium mb-3">{{ 'ANALYZE.PERSONA.TITLE' | translate }}</h3>
                    <div *ngIf="hasPersonaData()" class="flex-1 chart-wrapper">
                        <p-chart type="radar" [data]="personaChartData" [options]="radarChartOptions"></p-chart>
                    </div>
                    <div *ngIf="!hasPersonaData()" class="flex-1 flex items-center justify-center">
                        <p class="text-gray-500">{{ 'ANALYZE.PERSONA.NO_DATA' | translate }}</p>
                    </div>
                </div>
            </p-tabpanel>
        </p-tabs>
    </div>
</p-dialog>
