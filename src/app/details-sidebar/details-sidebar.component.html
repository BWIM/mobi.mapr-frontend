<div class="h-full">
    <p-scrollPanel [style]="{width: '100%', height: '100%'}">
      <div *ngIf="projectInfo" class="p-4">
        <div class="mb-4">
        </div>

        <div class="mb-6"  id="details-sidebar-content" >
          <h3 class="text-xl font-semibold text-primary mb-2">
            {{ projectInfo.display_name }}
          </h3> 
          <p class="text-gray-600">{{ projectInfo.description }}</p>
        </div>

        <div *ngIf="projectInfo.type !== 'hexagons'">
          <!-- <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">{{ 'SIDEBAR.AVERAGE_TYPE' | translate }}</label>
            <p-selectButton [options]="[
              { label: ('SIDEBAR.MEDIAN' | translate), value: 'median' },
              { label: ('SIDEBAR.AVERAGE' | translate), value: 'mean' }
            ]" [(ngModel)]="selectedAverageType" optionLabel="label" optionValue="value" (onChange)="onVisualizationChange()" [allowEmpty]="false">
            </p-selectButton>
          </div> -->

          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">{{ 'SIDEBAR.POPULATION_AREA' | translate }}</label>
            <p-selectButton [options]="populationAreaOptions" [(ngModel)]="selectedPopulationArea" optionLabel="label" optionValue="value" (onChange)="onVisualizationChange()" [allowEmpty]="false">
            </p-selectButton>
          </div>
        </div>

        <!-- <div class="mt-6 flex">
          <p-button 
            (mousedown)="setLowOpacity()"
            (mouseup)="resetOpacity()"
            (mouseleave)="resetOpacity()"
            icon="pi pi-eye-slash"
            [label]="'SIDEBAR.REDUCE_OPACITY' | translate"
            [pTooltip]="'SIDEBAR.REDUCE_OPACITY_TOOLTIP' | translate"
            [styleClass]="'p-button-secondary mb-4'">
          </p-button>
        </div> -->

        <!-- Separator -->
        <div class="my-6 border-t border-gray-200"></div>

        <p-fieldset legend="{{'SIDEBAR.ACTIVITIES' | translate}}" [toggleable]="true" [collapsed]="false">
          <ul class="list-disc pl-4 space-y-1">
            <li *ngFor="let activity of projectInfo.activities" class="text-gray-700">
              {{ activity }}
            </li>
          </ul>
        </p-fieldset>

        <p-fieldset legend="{{'SIDEBAR.MODES' | translate}}" [toggleable]="true" [collapsed]="true">
          <ul class="list-disc pl-4 space-y-1">
            <li *ngFor="let profile of projectInfo.profiles" class="text-gray-700">
              {{ profile }}
            </li>
          </ul>
        </p-fieldset>

        <p-fieldset *ngIf="projectInfo.personas" legend="{{'SIDEBAR.PERSONAS' | translate}}" [toggleable]="true" [collapsed]="true">
          <ul class="list-disc pl-4 space-y-1">
            <li *ngFor="let persona of projectInfo.personas" class="text-gray-700">
              {{ persona }}
            </li>
          </ul>
        </p-fieldset>

        <div class="mt-6 flex justify-center">
          <p-button 
            (onClick)="showPdfExportDialog()"
            icon="pi pi-file-pdf"
            [label]="'SIDEBAR.EXPORT_PDF' | translate"
            [pTooltip]="'SIDEBAR.EXPORT_PDF_TOOLTIP' | translate"
            styleClass="p-button-primary"
            [disabled]="isExporting">
          </p-button>
        </div>

        <div class="mt-6 flex justify-center">
          <p-button 
            (onClick)="toggleStatistics()"
            icon="pi pi-chart-bar"
            [label]="'STATISTICS.TITLE' | translate"
            [pTooltip]="'STATISTICS.SHOW_STATISTICS_TOOLTIP' | translate"
            styleClass="p-button-secondary">
          </p-button>
        </div>

        <div *ngIf="!isComparisonMode" class="mt-6 flex justify-center">
          <p-button 
            (onClick)="compareProjects()"
            icon="pi pi-arrows-h"
            [label]="'PROJECTS.COMPARE' | translate"
            styleClass="p-button-secondary">
          </p-button>
        </div>

        <div *ngIf="isComparisonMode" class="mt-6 flex justify-center">
          <p-button 
            (onClick)="exitComparisonMode()"
            icon="pi pi-times"
            [label]="'SIDEBAR.EXIT_COMPARISON' | translate"
            styleClass="p-button-danger">
          </p-button>
        </div>

        <div class="mt-6 flex justify-center">
          <p-button 
            (onClick)="generateShareLink()"
            icon="pi pi-share-alt"
            [label]="'SIDEBAR.SHARE' | translate"
            [pTooltip]="'SIDEBAR.SHARE_TOOLTIP' | translate"
            styleClass="p-button-secondary"
            [disabled]="isGeneratingShare">
            <p-progressSpinner *ngIf="isGeneratingShare" 
              [style]="{width: '20px', height: '20px'}" 
              styleClass="ml-2"></p-progressSpinner>
          </p-button>
        </div>


        <div *ngIf="shareUrl" class="mt-4 p-4 bg-gray-100 rounded">
          <div class="flex justify-between items-center mb-2">
            <p class="text-sm text-gray-600" (click)="copyToClipboard(shareUrl)">{{ 'SIDEBAR.SHARE_LINK' | translate }}:</p>
            <button class="text-blue-600 hover:text-blue-800 text-sm hover:cursor-pointer"
                    (click)="copyToClipboard(shareUrl)">
              <i class="pi pi-copy mr-1"></i>
              {{ 'SIDEBAR.COPY_LINK' | translate }}
            </button>
          </div>
          <div class="break-all">
            <a [href]="shareUrl" target="_blank" class="text-blue-600 hover:text-blue-800">
              {{shareUrl}}
            </a>
          </div>
        </div>
      </div>
      
      <div *ngIf="!projectInfo" class="p-4 text-center text-gray-500">
        {{ 'SIDEBAR.NO_PROJECT_SELECTED' | translate }}
      </div>
    </p-scrollPanel>
</div>

<p-dialog 
    [visible]="isExporting" 
    [modal]="true" 
    [closable]="false" 
    [draggable]="false"
    [resizable]="false"
    [closeOnEscape]="false"
    [style]="{width: '300px'}"
    [appendTo]="'body'"
    [showHeader]="false">
    <div class="flex flex-column align-items-center">
        <h3>{{ 'EXPORT.GENERATING_PDF' | translate }}</h3>
    </div>
</p-dialog>

<p-dialog 
  [(visible)]="showComparisonDialog" 
  [header]="translate.instant('SIDEBAR.COMPARISON_DIALOG_TITLE')"
  [modal]="true"
  [style]="{width: '50vw'}"
  [draggable]="false"
  [resizable]="false"
  styleClass="p-fluid">
  
  <div class="max-h-[60vh] overflow-y-auto">
    <div class="flex justify-center items-center h-full" *ngIf="comparisonProjects.length === 0">
      <p class="text-gray-500">{{ 'SIDEBAR.COMPARISON_DIALOG_NO_PROJECTS' | translate }}</p>
    </div>
    <div *ngFor="let project of comparisonProjects" 
         class="mb-4 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-all duration-200 ease-in-out cursor-pointer transform hover:-translate-y-1 hover:shadow-md"
         [class.border-primary]="selectedComparisonProject?.id === project.id"
         [class.bg-primary-50]="selectedComparisonProject?.id === project.id"
         (click)="onProjectSelect(project)">
      
      <div class="flex justify-between items-center mb-2">
        <h3 class="text-lg font-medium text-gray-900">{{project.display_name}}</h3>
        <span class="text-sm text-gray-500">v{{project.version}}</span>
      </div>
      
      <p *ngIf="project.description" 
         class="text-sm text-gray-600 mb-3">{{project.description}}</p>
      
      <div class="flex gap-4 text-xs text-gray-500">
        <span class="flex items-center">
          <i class="pi pi-calendar mr-1"></i>
          {{ 'SIDEBAR.CREATED' | translate }}: {{project.created | date}}
        </span>
      </div>
    </div>

  </div>
</p-dialog>

<p-toast></p-toast>